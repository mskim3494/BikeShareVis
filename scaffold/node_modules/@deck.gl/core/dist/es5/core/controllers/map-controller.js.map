{"version":3,"sources":["../../../../src/core/controllers/map-controller.js"],"names":["PREFIX","CURSOR","GRABBING","GRAB","POINTER","getDefaultCursor","isDragging","getPropTypes","PropTypes","width","number","isRequired","height","longitude","latitude","zoom","bearing","pitch","altitude","maxZoom","minZoom","maxPitch","minPitch","onViewportChange","func","onViewStateChange","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoomRotate","getCursor","controls","shape","events","arrayOf","string","handleEvent","defaultProps","Object","assign","MAPBOX_LIMITS","MapController","props","state","canvas","eventManager","EventManager","_eventManager","_controls","MapControls","setOptions","onStateChange","_onInteractiveStateChange","bind","destroy","style","cursor","displayName"],"mappings":"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","sourcesContent":["import MapControls from '../controllers/map-controls';\nimport {MAPBOX_LIMITS} from '../controllers/map-state';\nimport {EventManager} from 'mjolnir.js';\n\nconst PREFIX = '-webkit-';\n\nconst CURSOR = {\n  GRABBING: `${PREFIX}grabbing`,\n  GRAB: `${PREFIX}grab`,\n  POINTER: 'pointer'\n};\n\nconst getDefaultCursor = ({isDragging}) => (isDragging ? CURSOR.GRABBING : CURSOR.GRAB);\n\nfunction getPropTypes(PropTypes) {\n  return {\n    width: PropTypes.number.isRequired /** The width of the map. */,\n    height: PropTypes.number.isRequired /** The height of the map. */,\n    longitude: PropTypes.number.isRequired /** The longitude of the center of the map. */,\n    latitude: PropTypes.number.isRequired /** The latitude of the center of the map. */,\n    zoom: PropTypes.number.isRequired /** The tile zoom level of the map. */,\n    bearing: PropTypes.number /** Specify the bearing of the viewport */,\n    pitch: PropTypes.number /** Specify the pitch of the viewport */,\n    // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n    altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */,\n\n    /** Viewport constraints */\n    maxZoom: PropTypes.number, // Max zoom level\n    minZoom: PropTypes.number, // Min zoom level\n    maxPitch: PropTypes.number, // Max pitch in degrees\n    minPitch: PropTypes.number, // Min pitch in degrees\n\n    /**\n     * `onViewportChange` callback is fired when the user interacted with the\n     * map. The object passed to the callback contains viewport properties\n     * such as `longitude`, `latitude`, `zoom` etc.\n     */\n    onViewportChange: PropTypes.func,\n    onViewStateChange: PropTypes.func,\n\n    /** Enables control event handling */\n    scrollZoom: PropTypes.bool, // Scroll to zoom\n    dragPan: PropTypes.bool, // Drag to pan\n    dragRotate: PropTypes.bool, // Drag to rotate\n    doubleClickZoom: PropTypes.bool, // Double click to zoom\n    touchZoomRotate: PropTypes.bool, // Pinch to zoom / rotate\n\n    /** Accessor that returns a cursor style to show interactive state */\n    getCursor: PropTypes.func,\n\n    // A map control instance to replace the default map controls\n    // The object must expose one property: `events` as an array of subscribed\n    // event names; and two methods: `setState(state)` and `handle(event)`\n    controls: PropTypes.shape({\n      events: PropTypes.arrayOf(PropTypes.string),\n      handleEvent: PropTypes.func\n    })\n  };\n}\n\nconst defaultProps = Object.assign({}, MAPBOX_LIMITS, {\n  scrollZoom: true,\n  dragPan: true,\n  dragRotate: true,\n  doubleClickZoom: true,\n  touchZoomRotate: true,\n  getCursor: getDefaultCursor\n});\n\nexport default class MapController {\n  constructor(props) {\n    props = Object.assign({}, defaultProps, props);\n\n    this.props = props;\n    this.state = {\n      isDragging: false // Whether the cursor is down\n    };\n\n    this.canvas = props.canvas;\n\n    const eventManager = new EventManager(this.canvas);\n\n    this._eventManager = eventManager;\n\n    // If props.controls is not provided, fallback to default MapControls instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._controls = this.props.controls || new MapControls();\n    this._controls.setOptions(\n      Object.assign({}, this.props, {\n        onStateChange: this._onInteractiveStateChange.bind(this),\n        eventManager\n      })\n    );\n  }\n\n  setProps(props) {\n    props = Object.assign({}, this.props, props);\n    this.props = props;\n\n    this._controls.setOptions(props);\n  }\n\n  finalize() {\n    this._eventManager.destroy();\n  }\n\n  _onInteractiveStateChange({isDragging = false}) {\n    if (isDragging !== this.state.isDragging) {\n      this.state.isDragging = isDragging;\n      const {getCursor} = this.props;\n      this.canvas.style.cursor = getCursor(this.state);\n    }\n  }\n}\n\nMapController.displayName = 'MapController';\nMapController.defaultProps = defaultProps;\nMapController.getPropTypes = getPropTypes;\n"],"file":"map-controller.js"}