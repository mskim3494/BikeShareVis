{"version":3,"sources":["../../../../src/core-layers/geojson-layer/geojson-layer.js"],"names":["CompositeLayer","experimental","get","ScatterplotLayer","PathLayer","SolidPolygonLayer","getGeojsonFeatures","separateGeojsonFeatures","defaultLineColor","defaultFillColor","defaultProps","stroked","filled","extruded","wireframe","lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","Number","MAX_SAFE_INTEGER","lineJointRounded","lineMiterLimit","elevationScale","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","fp64","getLineColor","f","getFillColor","getRadius","getLineWidth","getElevation","subLayers","PointLayer","LineLayer","PolygonLayer","lightSettings","getCoordinates","geometry","coordinates","GeoJsonLayer","state","features","oldProps","props","changeFlags","dataChanged","data","info","Object","assign","object","feature","pointFeatures","lineFeatures","polygonFeatures","polygonOutlineFeatures","updateTriggers","drawPoints","length","drawLines","hasPolygonLines","hasPolygon","polygonFillLayer","getSubLayerProps","id","getPolygon","polygonLineLayer","getColor","getWidth","widthScale","widthMinPixels","widthMaxPixels","rounded","miterLimit","getPath","pathLayer","pointLayer","radiusScale","radiusMinPixels","radiusMaxPixels","getPosition","layerName"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {CompositeLayer, experimental} from '../../core';\nconst {get} = experimental;\nimport ScatterplotLayer from '../scatterplot-layer/scatterplot-layer';\nimport PathLayer from '../path-layer/path-layer';\n// Use primitive layer to avoid \"Composite Composite\" layers for now\nimport SolidPolygonLayer from '../solid-polygon-layer/solid-polygon-layer';\n\nimport {getGeojsonFeatures, separateGeojsonFeatures} from './geojson';\n\nconst defaultLineColor = [0x0, 0x0, 0x0, 0xff];\nconst defaultFillColor = [0x0, 0x0, 0x0, 0xff];\n\nconst defaultProps = {\n  stroked: true,\n  filled: true,\n  extruded: false,\n  wireframe: false,\n\n  lineWidthScale: 1,\n  lineWidthMinPixels: 0,\n  lineWidthMaxPixels: Number.MAX_SAFE_INTEGER,\n  lineJointRounded: false,\n  lineMiterLimit: 4,\n\n  elevationScale: 1,\n\n  pointRadiusScale: 1,\n  pointRadiusMinPixels: 0, //  min point radius in pixels\n  pointRadiusMaxPixels: Number.MAX_SAFE_INTEGER, // max point radius in pixels\n\n  fp64: false,\n\n  // Line and polygon outline color\n  getLineColor: f => get(f, 'properties.lineColor') || defaultLineColor,\n  // Point and polygon fill color\n  getFillColor: f => get(f, 'properties.fillColor') || defaultFillColor,\n  // Point radius\n  getRadius: f => get(f, 'properties.radius') || get(f, 'properties.size') || 1,\n  // Line and polygon outline accessors\n  getLineWidth: f => get(f, 'properties.lineWidth') || 1,\n  // Polygon extrusion accessor\n  getElevation: f => get(f, 'properties.elevation') || 1000,\n\n  subLayers: {\n    PointLayer: ScatterplotLayer,\n    LineLayer: PathLayer,\n    PolygonLayer: SolidPolygonLayer\n  },\n\n  // Optional settings for 'lighting' shader module\n  lightSettings: {}\n};\n\nconst getCoordinates = f => f.geometry.coordinates;\n\nexport default class GeoJsonLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      features: {}\n    };\n  }\n\n  updateState({oldProps, props, changeFlags}) {\n    if (changeFlags.dataChanged) {\n      const {data} = props;\n      const features = getGeojsonFeatures(data);\n      this.state.features = separateGeojsonFeatures(features);\n    }\n  }\n\n  getPickingInfo({info}) {\n    return Object.assign(info, {\n      // override object with picked feature\n      object: (info.object && info.object.feature) || info.object\n    });\n  }\n\n  /* eslint-disable complexity */\n  renderLayers() {\n    const {features} = this.state;\n    const {pointFeatures, lineFeatures, polygonFeatures, polygonOutlineFeatures} = features;\n\n    // Layer composition props\n    const {stroked, filled, extruded, wireframe, subLayers, lightSettings} = this.props;\n\n    // Rendering props underlying layer\n    const {\n      lineWidthScale,\n      lineWidthMinPixels,\n      lineWidthMaxPixels,\n      lineJointRounded,\n      lineMiterLimit,\n      pointRadiusScale,\n      pointRadiusMinPixels,\n      pointRadiusMaxPixels,\n      elevationScale,\n      fp64\n    } = this.props;\n\n    // Accessor props for underlying layers\n    const {\n      getLineColor,\n      getFillColor,\n      getRadius,\n      getLineWidth,\n      getElevation,\n      updateTriggers\n    } = this.props;\n\n    const drawPoints = pointFeatures && pointFeatures.length > 0;\n    const drawLines = lineFeatures && lineFeatures.length > 0;\n    const hasPolygonLines = polygonOutlineFeatures && polygonOutlineFeatures.length > 0;\n    const hasPolygon = polygonFeatures && polygonFeatures.length > 0;\n\n    // Filled Polygon Layer\n    const polygonFillLayer =\n      hasPolygon &&\n      new subLayers.PolygonLayer(\n        this.getSubLayerProps({\n          id: 'polygon-fill',\n          updateTriggers: {\n            getElevation: updateTriggers.getElevation,\n            getFillColor: updateTriggers.getFillColor,\n            getLineColor: updateTriggers.getLineColor\n          }\n        }),\n        {\n          data: polygonFeatures,\n          fp64,\n          extruded,\n          elevationScale,\n          filled,\n          wireframe,\n          lightSettings,\n          getPolygon: getCoordinates,\n          getElevation,\n          getFillColor,\n          getLineColor\n        }\n      );\n\n    const polygonLineLayer =\n      !extruded &&\n      stroked &&\n      hasPolygonLines &&\n      new subLayers.LineLayer(\n        this.getSubLayerProps({\n          id: 'polygon-outline',\n          updateTriggers: {\n            getColor: updateTriggers.getLineColor,\n            getWidth: updateTriggers.getLineWidth\n          }\n        }),\n        {\n          data: polygonOutlineFeatures,\n\n          fp64,\n          widthScale: lineWidthScale,\n          widthMinPixels: lineWidthMinPixels,\n          widthMaxPixels: lineWidthMaxPixels,\n          rounded: lineJointRounded,\n          miterLimit: lineMiterLimit,\n\n          getPath: getCoordinates,\n          getColor: getLineColor,\n          getWidth: getLineWidth\n        }\n      );\n\n    const pathLayer =\n      drawLines &&\n      new subLayers.LineLayer(\n        this.getSubLayerProps({\n          id: 'line-paths',\n          updateTriggers: {\n            getColor: updateTriggers.getLineColor,\n            getWidth: updateTriggers.getLineWidth\n          }\n        }),\n        {\n          data: lineFeatures,\n\n          fp64,\n          widthScale: lineWidthScale,\n          widthMinPixels: lineWidthMinPixels,\n          widthMaxPixels: lineWidthMaxPixels,\n          rounded: lineJointRounded,\n          miterLimit: lineMiterLimit,\n\n          getPath: getCoordinates,\n          getColor: getLineColor,\n          getWidth: getLineWidth\n        }\n      );\n\n    const pointLayer =\n      drawPoints &&\n      new subLayers.PointLayer(\n        this.getSubLayerProps({\n          id: 'points',\n          updateTriggers: {\n            getColor: updateTriggers.getFillColor,\n            getRadius: updateTriggers.getRadius\n          }\n        }),\n        {\n          data: pointFeatures,\n\n          fp64,\n          radiusScale: pointRadiusScale,\n          radiusMinPixels: pointRadiusMinPixels,\n          radiusMaxPixels: pointRadiusMaxPixels,\n\n          getPosition: getCoordinates,\n          getColor: getFillColor,\n          getRadius\n        }\n      );\n\n    return [\n      // If not extruded: flat fill layer is drawn below outlines\n      !extruded && polygonFillLayer,\n      polygonLineLayer,\n      pathLayer,\n      pointLayer,\n      // If extruded: draw fill layer last for correct blending behavior\n      extruded && polygonFillLayer\n    ];\n  }\n  /* eslint-enable complexity */\n}\n\nGeoJsonLayer.layerName = 'GeoJsonLayer';\nGeoJsonLayer.defaultProps = defaultProps;\n"],"file":"geojson-layer.js"}