{"version":3,"sources":["../../../../src/core/utils/fp64.js"],"names":["log","COORDINATE_SYSTEM","fp64ify","a","array","startIndex","hiPart","Math","fround","loPart","fp64ifyMatrix4","matrix","matrixFP64","Float32Array","i","j","index","fp64LowPart","enable64bitSupport","props","fp64","coordinateSystem","LNGLAT","once"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,OAAOA,GAAP,MAAgB,OAAhB;AACA,SAAQC,iBAAR,QAAgC,kBAAhC,C,CAAoD;;AAEpD;;;;;;AAKA,OAAO,SAASC,OAAT,CAAiBC,CAAjB,EAAgD;AAAA,MAA5BC,KAA4B,uEAApB,EAAoB;AAAA,MAAhBC,UAAgB,uEAAH,CAAG;AACrD,MAAMC,SAASC,KAAKC,MAAL,CAAYL,CAAZ,CAAf;AACA,MAAMM,SAASN,IAAII,KAAKC,MAAL,CAAYL,CAAZ,CAAnB;AACAC,QAAMC,UAAN,IAAoBC,MAApB;AACAF,QAAMC,aAAa,CAAnB,IAAwBI,MAAxB;AACA,SAAOL,KAAP;AACD,C,CAED;;AACA,OAAO,SAASM,cAAT,CAAwBC,MAAxB,EAAgC;AACrC;AACA,MAAMC,aAAa,IAAIC,YAAJ,CAAiB,EAAjB,CAAnB;;AACA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuB,EAAEA,CAAzB,EAA4B;AAC1B,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuB,EAAEA,CAAzB,EAA4B;AAC1B,UAAMC,QAAQF,IAAI,CAAJ,GAAQC,CAAtB;AACAb,cAAQS,OAAOI,IAAI,CAAJ,GAAQD,CAAf,CAAR,EAA2BF,UAA3B,EAAuCI,QAAQ,CAA/C;AACD;AACF;;AACD,SAAOJ,UAAP;AACD;AAED,OAAO,SAASK,WAAT,CAAqBd,CAArB,EAAwB;AAC7B,SAAOA,IAAII,KAAKC,MAAL,CAAYL,CAAZ,CAAX;AACD;AAED,OAAO,SAASe,kBAAT,CAA4BC,KAA5B,EAAmC;AACxC,MAAIA,MAAMC,IAAV,EAAgB;AACd,QAAID,MAAME,gBAAN,KAA2BpB,kBAAkBqB,MAAjD,EAAyD;AACvD,aAAO,IAAP;AACD;;AACDtB,QAAIuB,IAAJ,CACE,CADF;AAKD;;AAED,SAAO,KAAP;AACD","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// TODO - move to shaderlib utilities\nimport log from './log';\nimport {COORDINATE_SYSTEM} from '../lib/constants'; // TODO - utils should not import from lib\n\n/*\n * Frequently used small math utils: bundlers, especially webpack,\n * adds a thunk around every exported function that adds enough overhead to pull down performance.\n * It may be worth it to also export these as part of an object.\n */\nexport function fp64ify(a, array = [], startIndex = 0) {\n  const hiPart = Math.fround(a);\n  const loPart = a - Math.fround(a);\n  array[startIndex] = hiPart;\n  array[startIndex + 1] = loPart;\n  return array;\n}\n\n// calculate WebGL 64 bit matrix (transposed \"Float64Array\")\nexport function fp64ifyMatrix4(matrix) {\n  // Transpose the projection matrix to column major for GLSL.\n  const matrixFP64 = new Float32Array(32);\n  for (let i = 0; i < 4; ++i) {\n    for (let j = 0; j < 4; ++j) {\n      const index = i * 4 + j;\n      fp64ify(matrix[j * 4 + i], matrixFP64, index * 2);\n    }\n  }\n  return matrixFP64;\n}\n\nexport function fp64LowPart(a) {\n  return a - Math.fround(a);\n}\n\nexport function enable64bitSupport(props) {\n  if (props.fp64) {\n    if (props.coordinateSystem === COORDINATE_SYSTEM.LNGLAT) {\n      return true;\n    }\n    log.once(\n      0,\n      `64-bit mode only works with coordinateSystem set to\n      COORDINATE_SYSTEM.LNGLAT. Rendering in 32-bit mode instead`\n    );\n  }\n\n  return false;\n}\n"],"file":"fp64.js"}