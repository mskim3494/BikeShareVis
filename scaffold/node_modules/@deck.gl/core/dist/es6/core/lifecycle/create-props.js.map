{"version":3,"sources":["../../../../src/core/lifecycle/create-props.js"],"names":["applyPropOverrides","log","parsePropTypes","EMPTY_ARRAY","Object","freeze","createProps","layer","getPropDefs","constructor","defaultProps","newProps","create","_layer","enumerable","value","_asyncProps","i","arguments","length","assign","data","getOwnProperty","object","prop","prototype","hasOwnProperty","call","getLayerName","layerClass","layerName","once","name","props","propTypes","buildPropDefs","parent","parentClass","getPrototypeOf","parentPropDefs","layerDefaultProps","layerPropDefs","buildDefaultProps","_mergedDefaultProps","_propTypes","parentProps","descriptors","id","configurable","writable","defineProperties"],"mappings":"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","sourcesContent":["import {applyPropOverrides} from '../lib/seer-integration';\nimport log from '../utils/log';\nimport {parsePropTypes} from './prop-types';\n\nexport const EMPTY_ARRAY = Object.freeze([]);\n\n// Create a property object\nexport function createProps() {\n  const layer = this; // eslint-disable-line\n\n  // Get default prop object (a prototype chain for now)\n  const {defaultProps} = getPropDefs(layer.constructor);\n\n  // Create a new prop object with  default props object in prototype chain\n  const newProps = Object.create(defaultProps, {\n    _layer: {\n      enumerable: false,\n      value: layer\n    },\n    _asyncProps: {\n      enumerable: false,\n      value: {}\n    }\n  });\n\n  // \"Copy\" all sync props\n  for (let i = 0; i < arguments.length; ++i) {\n    Object.assign(newProps, arguments[i]);\n  }\n  newProps.data = newProps.data || EMPTY_ARRAY;\n\n  // SEER: Apply any overrides from the seer debug extension if it is active\n  applyPropOverrides(newProps);\n\n  // Props must be immutable\n  Object.freeze(newProps);\n\n  return newProps;\n}\n\n// Helper methods\n\n// Constructors have their super class constructors as prototypes\nfunction getOwnProperty(object, prop) {\n  return Object.prototype.hasOwnProperty.call(object, prop) && object[prop];\n}\n\nfunction getLayerName(layerClass) {\n  const layerName = getOwnProperty(layerClass, 'layerName');\n  if (!layerName) {\n    log.once(0, `${layerClass.name}.layerName not specified`);\n  }\n  return layerName || layerClass.name;\n}\n\n// Return precalculated defaultProps and propType objects if available\n// build them if needed\nfunction getPropDefs(layerClass) {\n  const props = getOwnProperty(layerClass, '_mergedDefaultProps');\n  if (props) {\n    return {\n      defaultProps: props,\n      propTypes: getOwnProperty(layerClass, '_propTypes')\n    };\n  }\n\n  return buildPropDefs(layerClass);\n}\n\n// Build defaultProps and propType objects by walking layer prototype chain\nfunction buildPropDefs(layerClass) {\n  const parent = layerClass.prototype;\n  if (!parent) {\n    return {\n      defaultProps: {}\n    };\n  }\n\n  const parentClass = Object.getPrototypeOf(layerClass);\n  const parentPropDefs = (parent && getPropDefs(parentClass)) || null;\n\n  // Parse propTypes from Layer.defaultProps\n  const layerDefaultProps = getOwnProperty(layerClass, 'defaultProps') || {};\n  const layerPropDefs = parsePropTypes(layerDefaultProps);\n\n  // Create a merged type object\n  const propTypes = Object.assign(\n    {},\n    parentPropDefs && parentPropDefs.propTypes,\n    layerPropDefs.propTypes\n  );\n\n  // Create any necessary property descriptors and create the default prop object\n  // Assign merged default props\n  const defaultProps = buildDefaultProps(\n    layerPropDefs.defaultProps,\n    parentPropDefs && parentPropDefs.defaultProps,\n    propTypes,\n    layerClass\n  );\n\n  // Store the precalculated props\n  layerClass._mergedDefaultProps = defaultProps;\n  layerClass._propTypes = propTypes;\n\n  return {propTypes, defaultProps};\n}\n\nfunction buildDefaultProps(props, parentProps, propTypes, layerClass) {\n  const defaultProps = Object.create(null);\n\n  Object.assign(defaultProps, parentProps, props);\n\n  const descriptors = {};\n\n  const id = getLayerName(layerClass);\n  delete props.id;\n\n  Object.assign(descriptors, {\n    id: {\n      configurable: false,\n      writable: true,\n      value: id\n    }\n  });\n\n  Object.defineProperties(defaultProps, descriptors);\n\n  return defaultProps;\n}\n"],"file":"create-props.js"}