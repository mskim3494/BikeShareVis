{"version":3,"sources":["../../../src/core/animation-loop.js"],"names":["window","log","getPageLoadPromise","resizeDrawingBuffer","createGLContext","isWebGL","resetParameters","makeDebugContext","Framebuffer","assert","requestAnimationFrame","callback","setTimeout","cancelAnimationFrame","timerId","clearTimeout","DEFAULT_GL_OPTIONS","preserveDrawingBuffer","AnimationLoop","props","onCreateContext","opts","onInitialize","onRender","onFinalize","offScreen","gl","glOptions","debug","createFramebuffer","autoResizeViewport","autoResizeDrawingBuffer","useDevicePixels","deprecated","useDevicePixelRatio","needsRedraw","setProps","start","bind","stop","_renderFrame","reason","_stopped","_animationFrameId","_startPromise","then","_createWebGLContext","_createFramebuffer","_initializeCallbackData","_updateCallbackData","_resizeCanvasDrawingBuffer","_resizeViewport","_callbackData","_addCallbackData","appContext","_finalizeCallbackData","autoResizeCanvas","_onSetupFrame","_resizeFramebuffer","_setupFrame","commit","canvas","framebuffer","tick","tock","width","drawingBufferWidth","height","drawingBufferHeight","setNeedsRedraw","aspect","Object","assign","Error","viewport","resize"],"mappings":";;;;;;;;;;AAAA;AACA,SAAQA,MAAR,QAAqB,kBAArB;AACA,SAAQC,GAAR,QAAkB,UAAlB;AACA,SAAQC,kBAAR,EAA4BC,mBAA5B,QAAsD,gBAAtD;AACA,SAAQC,eAAR,EAAyBC,OAAzB,EAAkCC,eAAlC,QAAwD,UAAxD;AACA,SAAQC,gBAAR,QAA+B,8BAA/B;AACA,SAAQC,WAAR,QAA0B,UAA1B;AACA,OAAOC,MAAP,MAAmB,iBAAnB,C,CAEA;;AACA,OAAO,SAASC,qBAAT,CAA+BC,QAA/B,EAAyC;AAC9C,SAAOX,OAAOU,qBAAP,GACLV,OAAOU,qBAAP,CAA6BC,QAA7B,CADK,GAELC,WAAWD,QAAX,EAAqB,OAAO,EAA5B,CAFF;AAGD;AAED,OAAO,SAASE,oBAAT,CAA8BC,OAA9B,EAAuC;AAC5C,SAAOd,OAAOU,qBAAP,GACLV,OAAOa,oBAAP,CAA4BC,OAA5B,CADK,GAELC,aAAaD,OAAb,CAFF;AAGD;AAED,IAAME,qBAAqB;AACzBC,yBAAuB;AADE,CAA3B;;IAIqBC,a;;;AACnB;;;AAGA,2BAAwB;AAAA,QAAZC,KAAY,uEAAJ,EAAI;;AAAA;;AAAA,gCAiBlBA,KAjBkB,CAEpBC,eAFoB;AAAA,QAEpBA,eAFoB,sCAEF;AAAA,aAAQhB,gBAAgBiB,IAAhB,CAAR;AAAA,KAFE;AAAA,8BAiBlBF,KAjBkB,CAGpBG,YAHoB;AAAA,QAGpBA,YAHoB,oCAGL,YAAM,CAAE,CAHH;AAAA,0BAiBlBH,KAjBkB,CAIpBI,QAJoB;AAAA,QAIpBA,QAJoB,gCAIT,YAAM,CAAE,CAJC;AAAA,4BAiBlBJ,KAjBkB,CAKpBK,UALoB;AAAA,QAKpBA,UALoB,kCAKP,YAAM,CAAE,CALD;AAAA,2BAiBlBL,KAjBkB,CAOpBM,SAPoB;AAAA,QAOpBA,SAPoB,iCAOR,KAPQ;AAAA,oBAiBlBN,KAjBkB,CAQpBO,EARoB;AAAA,QAQpBA,EARoB,0BAQf,IARe;AAAA,2BAiBlBP,KAjBkB,CASpBQ,SAToB;AAAA,QASpBA,SAToB,iCASR,EATQ;AAAA,uBAiBlBR,KAjBkB,CAUpBS,KAVoB;AAAA,QAUpBA,KAVoB,6BAUZ,KAVY;AAAA,gCAiBlBT,KAjBkB,CAYpBU,iBAZoB;AAAA,QAYpBA,iBAZoB,sCAYA,KAZA;AAAA,gCAiBlBV,KAjBkB,CAepBW,kBAfoB;AAAA,QAepBA,kBAfoB,sCAeC,IAfD;AAAA,gCAiBlBX,KAjBkB,CAgBpBY,uBAhBoB;AAAA,QAgBpBA,uBAhBoB,sCAgBM,IAhBN;AAAA,gCAqBlBZ,KArBkB,CAoBpBa,eApBoB;AAAA,QAoBpBA,eApBoB,sCAoBF,IApBE;;AAuBtB,QAAI,yBAAyBb,KAA7B,EAAoC;AAClClB,UAAIgC,UAAJ,CAAe,qBAAf,EAAsC,iBAAtC;AACAD,wBAAkBb,MAAMe,mBAAxB;AACD;;AAED,SAAKf,KAAL,GAAa;AACXC,sCADW;AAEXE,gCAFW;AAGXC,wBAHW;AAIXC,4BAJW;AAMXE,YANW;AAOXC,0BAPW;AAQXC,kBARW;AASXC;AATW,KAAb,CA5BsB,CAwCtB;;AACA,SAAKH,EAAL,GAAUA,EAAV;AACA,SAAKD,SAAL,GAAiBA,SAAjB;AACA,SAAKU,WAAL,GAAmB,IAAnB;AAEA,SAAKC,QAAL,CAAc;AACZN,4CADY;AAEZC,sDAFY;AAGZC;AAHY,KAAd,EA7CsB,CAmDtB;;AACA,SAAKK,KAAL,GAAa,KAAKA,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAb;AACA,SAAKC,IAAL,GAAY,KAAKA,IAAL,CAAUD,IAAV,CAAe,IAAf,CAAZ;AACA,SAAKE,YAAL,GAAoB,KAAKA,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAApB;AAEA,WAAO,IAAP;AACD;;;;mCAEcG,M,EAAQ;AACrBhC,aAAO,OAAOgC,MAAP,KAAkB,QAAzB;AACA,WAAKN,WAAL,GAAmB,KAAKA,WAAL,IAAoBM,MAAvC;AACA,aAAO,IAAP;AACD;;;6BAEQtB,K,EAAO;AACd,UAAI,wBAAwBA,KAA5B,EAAmC;AACjC,aAAKW,kBAAL,GAA0BX,MAAMW,kBAAhC;AACD;;AACD,UAAI,6BAA6BX,KAAjC,EAAwC;AACtC,aAAKY,uBAAL,GAA+BZ,MAAMY,uBAArC;AACD;;AACD,UAAI,qBAAqBZ,KAAzB,EAAgC;AAC9B,aAAKa,eAAL,GAAuBb,MAAMa,eAA7B;AACD;;AACD,aAAO,IAAP;AACD,K,CAED;AACA;;;;4BACiB;AAAA;;AAAA,UAAXX,IAAW,uEAAJ,EAAI;AACf,WAAKqB,QAAL,GAAgB,KAAhB,CADe,CAEf;;AACA,UAAI,CAAC,KAAKC,iBAAV,EAA6B;AAC3B;AACA,aAAKC,aAAL,GAAqB1C,qBACpB2C,IADoB,CACf,YAAM;AACV,cAAI,MAAKH,QAAT,EAAmB;AACjB,mBAAO,IAAP;AACD,WAHS,CAKV;;;AACA,gBAAKI,mBAAL,CAAyBzB,IAAzB;;AACA,gBAAK0B,kBAAL,GAPU,CASV;;;AACA,gBAAKC,uBAAL;;AACA,gBAAKC,mBAAL,GAXU,CAaV;;;AACA,gBAAKC,0BAAL;;AACA,gBAAKC,eAAL,GAfU,CAiBV;;;AACA,iBAAO,MAAKhC,KAAL,CAAWG,YAAX,CAAwB,MAAK8B,aAA7B,CAAP;AACD,SApBoB,EAqBpBP,IArBoB,CAqBf,sBAAc;AAClB,cAAI,CAAC,MAAKH,QAAV,EAAoB;AAClB,kBAAKW,gBAAL,CAAsBC,cAAc,EAApC;;AACA,gBAAIA,eAAe,KAAf,IAAwB,CAAC,MAAKX,iBAAlC,EAAqD;AACnD,oBAAKA,iBAAL,GAAyBjC,sBAAsB,MAAK8B,YAA3B,CAAzB;AACD;AACF;AACF,SA5BoB,CAArB;AA8BD;;AACD,aAAO,IAAP;AACD,K,CAED;;;;2BACO;AACL;AACA,UAAI,KAAKG,iBAAT,EAA4B;AAC1B,aAAKY,qBAAL;;AACA1C,6BAAqB,KAAK8B,iBAA1B;AACA,aAAKA,iBAAL,GAAyB,IAAzB;AACA,aAAKD,QAAL,GAAgB,IAAhB;AACD;;AACD,aAAO,IAAP;AACD,K,CAED;AAEA;;;;4CAOG;AAAA,uCALDX,uBAKC;AAAA,UALDA,uBAKC,sCALyB,IAKzB;AAAA,uCAJDyB,gBAIC;AAAA,UAJDA,gBAIC,sCAJkB,IAIlB;AAAA,uCAHD1B,kBAGC;AAAA,UAHDA,kBAGC,sCAHoB,IAGpB;AAAA,sCAFDE,eAEC;AAAA,UAFDA,eAEC,qCAFiB,IAEjB;AAAA,uCADDE,mBACC;AAAA,UADDA,mBACC,sCADqB,IACrB;AACDjC,UAAIgC,UAAJ,CAAe,iCAAf,EAAkD,wBAAlD;AACA,WAAKH,kBAAL,GAA0BA,kBAA1B;AACA,WAAK0B,gBAAL,GAAwBA,gBAAxB;AACA,WAAKzB,uBAAL,GAA+BA,uBAA/B;AACA,WAAKC,eAAL,GAAuBA,eAAvB;;AACA,UAAIE,wBAAwB,IAA5B,EAAkC;AAChCjC,YAAIgC,UAAJ,CAAe,qBAAf,EAAsC,iBAAtC;AACA,aAAKD,eAAL,GAAuBE,mBAAvB;AACD;;AACD,aAAO,IAAP;AACD,K,CAED;;;;kCAEc;AACZ,UAAI,KAAKuB,aAAT,EAAwB;AACtB;AACA,aAAKA,aAAL,CAAmB,KAAKL,aAAxB,EAFsB,CAGtB;;AACD,OAJD,MAIO;AACL,aAAKF,0BAAL;;AACA,aAAKC,eAAL;;AACA,aAAKO,kBAAL;AACD;AACF;AAED;;;;;;;;mCAKe;AACb,UAAI,KAAKhB,QAAT,EAAmB;AACjB;AACD;;AAED,WAAKiB,WAAL;;AACA,WAAKV,mBAAL,GANa,CAQb;;;AACA,WAAK9B,KAAL,CAAWI,QAAX,CAAoB,KAAK6B,aAAzB,EATa,CAUb;;AAEA,UAAI,KAAK3B,SAAT,EAAoB;AAClB;AACA,aAAKC,EAAL,CAAQkC,MAAR,GAAiBf,IAAjB,CAAsB,KAAKL,YAA3B;AACD,OAHD,MAGO;AACL;AACA,aAAKG,iBAAL,GAAyBjC,sBAAsB,KAAK8B,YAA3B,CAAzB;AACD;AACF,K,CAED;;;;8CAC0B;AACxB,WAAKY,aAAL,GAAqB;AACnB1B,YAAI,KAAKA,EADU;AAEnBmC,gBAAQ,KAAKnC,EAAL,CAAQmC,MAFG;AAGnBC,qBAAa,KAAKA,WAHC;AAInBvB,cAAM,KAAKA,IAJQ;AAKnB;AACAP,yBAAiB,KAAKA,eANH;AAOnBG,qBAAa,IAPM;AAQnB4B,cAAM,CARa;AASnBC,cAAM;AATa,OAArB;AAWD,K,CAED;;;;0CACsB;AACpB;AACA,UAAMC,QAAQ,KAAKvC,EAAL,CAAQwC,kBAAtB;AACA,UAAMC,SAAS,KAAKzC,EAAL,CAAQ0C,mBAAvB;;AACA,UAAIH,UAAU,KAAKb,aAAL,CAAmBa,KAA7B,IAAsCE,WAAW,KAAKf,aAAL,CAAmBe,MAAxE,EAAgF;AAC9E,aAAKE,cAAL,CAAoB,wBAApB;AACD;;AACD,WAAKjB,aAAL,CAAmBa,KAAnB,GAA2BA,KAA3B;AACA,WAAKb,aAAL,CAAmBe,MAAnB,GAA4BA,MAA5B;AACA,WAAKf,aAAL,CAAmBkB,MAAnB,GAA4BL,QAAQE,MAApC;AACA,WAAKf,aAAL,CAAmBjB,WAAnB,GAAiC,KAAKA,WAAtC;AACA,WAAKiB,aAAL,CAAmB3B,SAAnB,GAA+B,KAAKA,SAApC,CAXoB,CAapB;;AACA,WAAK2B,aAAL,CAAmBjB,WAAnB,GAAiC,KAAKA,WAAtC;AACA,WAAKA,WAAL,GAAmB,IAAnB,CAfoB,CAiBpB;;AACA,WAAKiB,aAAL,CAAmBW,IAAnB;AACD;;;4CAEuB;AACtB;AACA,WAAK5C,KAAL,CAAWK,UAAX,CAAsB,KAAK4B,aAA3B,EAFsB,CAGtB;AACD,K,CAED;;;;qCACiBE,U,EAAY;AAC3B,UAAI,QAAOA,UAAP,MAAsB,QAAtB,IAAkCA,eAAe,IAArD,EAA2D;AACzD,aAAKF,aAAL,GAAqBmB,OAAOC,MAAP,CAAc,EAAd,EAAkB,KAAKpB,aAAvB,EAAsCE,UAAtC,CAArB;AACD;AACF,K,CAED;;;;wCACoBjC,I,EAAM;AACxB;AACAA,aAAOkD,OAAOC,MAAP,CAAc,EAAd,EAAkBnD,IAAlB,EAAwBL,kBAAxB,EAA4C,KAAKG,KAAL,CAAWQ,SAAvD,CAAP;AACA,WAAKD,EAAL,GAAU,KAAKP,KAAL,CAAWO,EAAX,IAAiB,KAAKP,KAAL,CAAWC,eAAX,CAA2BC,IAA3B,CAA3B;;AAEA,UAAI,CAAChB,QAAQ,KAAKqB,EAAb,CAAL,EAAuB;AACrB,cAAM,IAAI+C,KAAJ,CAAU,0DAAV,CAAN;AACD;;AAED,UAAI,KAAKtD,KAAL,CAAWS,KAAf,EAAsB;AACpB,aAAKF,EAAL,GAAUnB,iBAAiB,KAAKmB,EAAtB,CAAV;AACD,OAXuB,CAaxB;;;AACApB,sBAAgB,KAAKoB,EAArB;AACD,K,CAED;;;;sCACkB;AAChB,UAAI,KAAKI,kBAAT,EAA6B;AAC3B,aAAKJ,EAAL,CAAQgD,QAAR,CAAiB,CAAjB,EAAoB,CAApB,EAAuB,KAAKhD,EAAL,CAAQwC,kBAA/B,EAAmD,KAAKxC,EAAL,CAAQ0C,mBAA3D;AACD;AACF,K,CAED;AACA;;;;iDAC6B;AAC3B,UAAI,KAAKrC,uBAAT,EAAkC;AAChC5B,4BAAoB,KAAKuB,EAAL,CAAQmC,MAA5B,EAAoC;AAAC7B,2BAAiB,KAAKA;AAAvB,SAApC;AACD;AACF,K,CAED;;;;yCACqB;AACnB;AACA,UAAI,KAAKb,KAAL,CAAWU,iBAAf,EAAkC;AAChC,aAAKiC,WAAL,GAAmB,IAAItD,WAAJ,CAAgB,KAAKkB,EAArB,CAAnB;AACD;AACF;;;yCAEoB;AACnB,UAAI,KAAKoC,WAAT,EAAsB;AACpB,aAAKA,WAAL,CAAiBa,MAAjB,CAAwB;AACtBV,iBAAO,KAAKvC,EAAL,CAAQwC,kBADO;AAEtBC,kBAAQ,KAAKzC,EAAL,CAAQ0C;AAFM,SAAxB;AAID;AACF;;;;;;SAvSkBlD,a","sourcesContent":["/* global setTimeout, clearTimeout */\nimport {window} from '../utils/globals';\nimport {log} from '../utils';\nimport {getPageLoadPromise, resizeDrawingBuffer} from '../webgl-utils';\nimport {createGLContext, isWebGL, resetParameters} from '../webgl';\nimport {makeDebugContext} from '../webgl-utils/debug-context';\nimport {Framebuffer} from '../webgl';\nimport assert from '../utils/assert';\n\n// Node.js polyfills for requestAnimationFrame and cancelAnimationFrame\nexport function requestAnimationFrame(callback) {\n  return window.requestAnimationFrame ?\n    window.requestAnimationFrame(callback) :\n    setTimeout(callback, 1000 / 60);\n}\n\nexport function cancelAnimationFrame(timerId) {\n  return window.requestAnimationFrame ?\n    window.cancelAnimationFrame(timerId) :\n    clearTimeout(timerId);\n}\n\nconst DEFAULT_GL_OPTIONS = {\n  preserveDrawingBuffer: true\n};\n\nexport default class AnimationLoop {\n  /*\n   * @param {HTMLCanvasElement} canvas - if provided, width and height will be passed to context\n   */\n  constructor(props = {}) {\n    const {\n      onCreateContext = opts => createGLContext(opts),\n      onInitialize = () => {},\n      onRender = () => {},\n      onFinalize = () => {},\n\n      offScreen = false,\n      gl = null,\n      glOptions = {},\n      debug = false,\n\n      createFramebuffer = false,\n\n      // view parameters\n      autoResizeViewport = true,\n      autoResizeDrawingBuffer = true\n    } = props;\n\n    let {\n      useDevicePixels = true\n    } = props;\n\n    if ('useDevicePixelRatio' in props) {\n      log.deprecated('useDevicePixelRatio', 'useDevicePixels')();\n      useDevicePixels = props.useDevicePixelRatio;\n    }\n\n    this.props = {\n      onCreateContext,\n      onInitialize,\n      onRender,\n      onFinalize,\n\n      gl,\n      glOptions,\n      debug,\n      createFramebuffer\n    };\n\n    // state\n    this.gl = gl;\n    this.offScreen = offScreen;\n    this.needsRedraw = null;\n\n    this.setProps({\n      autoResizeViewport,\n      autoResizeDrawingBuffer,\n      useDevicePixels\n    });\n\n    // Bind methods\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n    this._renderFrame = this._renderFrame.bind(this);\n\n    return this;\n  }\n\n  setNeedsRedraw(reason) {\n    assert(typeof reason === 'string');\n    this.needsRedraw = this.needsRedraw || reason;\n    return this;\n  }\n\n  setProps(props) {\n    if ('autoResizeViewport' in props) {\n      this.autoResizeViewport = props.autoResizeViewport;\n    }\n    if ('autoResizeDrawingBuffer' in props) {\n      this.autoResizeDrawingBuffer = props.autoResizeDrawingBuffer;\n    }\n    if ('useDevicePixels' in props) {\n      this.useDevicePixels = props.useDevicePixels;\n    }\n    return this;\n  }\n\n  // Starts a render loop if not already running\n  // @param {Object} context - contains frame specific info (E.g. tick, width, height, etc)\n  start(opts = {}) {\n    this._stopped = false;\n    // console.debug(`Starting ${this.constructor.name}`);\n    if (!this._animationFrameId) {\n      // Wait for start promise before rendering frame\n      this._startPromise = getPageLoadPromise()\n      .then(() => {\n        if (this._stopped) {\n          return null;\n        }\n\n        // Create the WebGL context\n        this._createWebGLContext(opts);\n        this._createFramebuffer();\n\n        // Initialize the callback data\n        this._initializeCallbackData();\n        this._updateCallbackData();\n\n        // Default viewport setup, in case onInitialize wants to render\n        this._resizeCanvasDrawingBuffer();\n        this._resizeViewport();\n\n        // Note: onIntialize can return a promise (in case it needs to load resources)\n        return this.props.onInitialize(this._callbackData);\n      })\n      .then(appContext => {\n        if (!this._stopped) {\n          this._addCallbackData(appContext || {});\n          if (appContext !== false && !this._animationFrameId) {\n            this._animationFrameId = requestAnimationFrame(this._renderFrame);\n          }\n        }\n      });\n\n    }\n    return this;\n  }\n\n  // Stops a render loop if already running, finalizing\n  stop() {\n    // console.debug(`Stopping ${this.constructor.name}`);\n    if (this._animationFrameId) {\n      this._finalizeCallbackData();\n      cancelAnimationFrame(this._animationFrameId);\n      this._animationFrameId = null;\n      this._stopped = true;\n    }\n    return this;\n  }\n\n  // DEPRECATED METHODS\n\n  // Update parameters\n  setViewParameters({\n    autoResizeDrawingBuffer = true,\n    autoResizeCanvas = true,\n    autoResizeViewport = true,\n    useDevicePixels = true,\n    useDevicePixelRatio = null // deprecated\n  }) {\n    log.deprecated('AnimationLoop.setViewParameters', 'AnimationLoop.setProps')();\n    this.autoResizeViewport = autoResizeViewport;\n    this.autoResizeCanvas = autoResizeCanvas;\n    this.autoResizeDrawingBuffer = autoResizeDrawingBuffer;\n    this.useDevicePixels = useDevicePixels;\n    if (useDevicePixelRatio !== null) {\n      log.deprecated('useDevicePixelRatio', 'useDevicePixels')();\n      this.useDevicePixels = useDevicePixelRatio;\n    }\n    return this;\n  }\n\n  // PRIVATE METHODS\n\n  _setupFrame() {\n    if (this._onSetupFrame) {\n      // call callback\n      this._onSetupFrame(this._callbackData);\n      // end callback\n    } else {\n      this._resizeCanvasDrawingBuffer();\n      this._resizeViewport();\n      this._resizeFramebuffer();\n    }\n  }\n\n  /**\n   * @private\n   * Handles a render loop frame - updates context and calls the application\n   * callback\n   */\n  _renderFrame() {\n    if (this._stopped) {\n      return;\n    }\n\n    this._setupFrame();\n    this._updateCallbackData();\n\n    // call callback\n    this.props.onRender(this._callbackData);\n    // end callback\n\n    if (this.offScreen) {\n      // commit returns a Promise\n      this.gl.commit().then(this._renderFrame);\n    } else {\n      // Request another render frame (now )\n      this._animationFrameId = requestAnimationFrame(this._renderFrame);\n    }\n  }\n\n  // Initialize the  object that will be passed to app callbacks\n  _initializeCallbackData() {\n    this._callbackData = {\n      gl: this.gl,\n      canvas: this.gl.canvas,\n      framebuffer: this.framebuffer,\n      stop: this.stop,\n      // Initial values\n      useDevicePixels: this.useDevicePixels,\n      needsRedraw: null,\n      tick: 0,\n      tock: 0\n    };\n  }\n\n  // Update the context object that will be passed to app callbacks\n  _updateCallbackData() {\n    // CallbackData width and height represent drawing buffer width and height\n    const width = this.gl.drawingBufferWidth;\n    const height = this.gl.drawingBufferHeight;\n    if (width !== this._callbackData.width || height !== this._callbackData.height) {\n      this.setNeedsRedraw('drawing buffer resized');\n    }\n    this._callbackData.width = width;\n    this._callbackData.height = height;\n    this._callbackData.aspect = width / height;\n    this._callbackData.needsRedraw = this.needsRedraw;\n    this._callbackData.offScreen = this.offScreen;\n\n    // Update redraw reason\n    this._callbackData.needsRedraw = this.needsRedraw;\n    this.needsRedraw = null;\n\n    // Increment tick\n    this._callbackData.tick++;\n  }\n\n  _finalizeCallbackData() {\n    // call callback\n    this.props.onFinalize(this._callbackData);\n    // end callback\n  }\n\n  // Add application's data to the app context object\n  _addCallbackData(appContext) {\n    if (typeof appContext === 'object' && appContext !== null) {\n      this._callbackData = Object.assign({}, this._callbackData, appContext);\n    }\n  }\n\n  // Either uses supplied or existing context, or calls provided callback to create one\n  _createWebGLContext(opts) {\n    // Create the WebGL context if necessary\n    opts = Object.assign({}, opts, DEFAULT_GL_OPTIONS, this.props.glOptions);\n    this.gl = this.props.gl || this.props.onCreateContext(opts);\n\n    if (!isWebGL(this.gl)) {\n      throw new Error('AnimationLoop.onCreateContext - illegal context returned');\n    }\n\n    if (this.props.debug) {\n      this.gl = makeDebugContext(this.gl);\n    }\n\n    // Reset the WebGL context.\n    resetParameters(this.gl);\n  }\n\n  // Default viewport setup\n  _resizeViewport() {\n    if (this.autoResizeViewport) {\n      this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n    }\n  }\n\n  // Resize the render buffer of the canvas to match canvas client size\n  // Optionally multiplying with devicePixel ratio\n  _resizeCanvasDrawingBuffer() {\n    if (this.autoResizeDrawingBuffer) {\n      resizeDrawingBuffer(this.gl.canvas, {useDevicePixels: this.useDevicePixels});\n    }\n  }\n\n  // TBD - deprecated?\n  _createFramebuffer() {\n    // Setup default framebuffer\n    if (this.props.createFramebuffer) {\n      this.framebuffer = new Framebuffer(this.gl);\n    }\n  }\n\n  _resizeFramebuffer() {\n    if (this.framebuffer) {\n      this.framebuffer.resize({\n        width: this.gl.drawingBufferWidth,\n        height: this.gl.drawingBufferHeight\n      });\n    }\n  }\n}\n"],"file":"animation-loop.js"}